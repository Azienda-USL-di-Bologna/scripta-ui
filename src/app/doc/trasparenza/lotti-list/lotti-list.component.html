<p-toast></p-toast>
<p-confirmDialog icon="pi pi-exclamation-triangle"></p-confirmDialog>
<div class="first-div">
  <div class="box-ricerca">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input #inputGobalFilter pInputText 
        type="text"  
        placeholder="Cerca per CIG"
        tooltipPosition="bottom"
        (input)="dt.filterGlobal($any($event.target).value, 'contains')">
    </span>
  </div>
  <div style="height: calc(100vh - 105px);">
    <p-table
      #dt
      [value]="listaLotti"
      responsiveLayout="scroll"
      [rowHover]="true"
      [paginator]="true"
      [totalRecords]="totalRecords"
      [rows]="15"
      currentPageReportTemplate="Visualizzati da {first} a {last} di {totalRecords} lotti"
      [showCurrentPageReport]="true"
      [columns]="cols"
      [loading]="loading"
      scrollHeight="flex"  
      [scrollable]="true"
      [globalFilterFields]="['cig']">
      <ng-template pTemplate="header">
          <tr>
            <th style="min-width:10%">CIG</th>
            <th style="min-width:10%">Lotto</th>
            <th style="min-width:40%">Oggetto</th>
            <th style="min-width:12%">Tipologia</th>
            <th style="min-width:10%">Importo Totale</th>
            <th style="min-width:10%">Importo Liquidato</th>
            <th style="min-width:7%"></th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowdata let-ri="rowIndex">
          <tr>
            <td style="min-width:10%; overflow-wrap:anywhere;">
              {{rowdata.cig}}
            </td>
            <td style="min-width:10%; overflow-wrap:anywhere; ">
              {{rowdata.lotto}}
            </td>
            <td style="min-width:40%; overflow-wrap:anywhere;">
              {{rowdata.oggetto}}
            </td>
            <td style="min-width:12%; overflow-wrap:anywhere;">
              {{rowdata.idTipologia.nome}}
            </td>
            <td style="min-width:10%; overflow-wrap:anywhere;">
              {{rowdata.importoTotale | number:'1.2': 'it-IT'}}
            </td>
            <td style="min-width:10%; overflow-wrap:anywhere;">
              {{rowdata.importoLiquidato | number:'1.2': 'it-IT'}}
            </td>
              <td style="text-align:center; min-width:7%">
                <button pButton pRipple type="button" icon="pi pi-pencil" (click)="onRowEditInit(rowdata)" class="p-button-rounded"></button>
                <button pButton pRipple type="button" pCancelRow icon="pi pi-trash" (click)="deleteRow(rowdata)" class="p-button-rounded"></button>
              </td>
          </tr>
      </ng-template>
    </p-table>
    <div class="top-footer-buttons">
      <div>
        <button pButton pRipple type="button" label="Aggiungi Lotto" (click)="aggiungiLotto()" class="p-button-text"></button>
        <button pButton pRipple type="button" label="Importa Ordini in Economia" (click)="chiudiLottoList()" class="p-button-text"></button>
      </div>
      <button pButton pRipple type="button" label="Chiudi" (click)="chiudiLottoList()" class="p-button-text"></button>
    </div>
  </div>
</div>
<p-dialog
  *ngIf="dialogDisplay"
  header="Dettaglio Lotto" 
  [(visible)]="dialogDisplay" 
  [style]="{width: '70vw', height: '70vh'}" 
  appendTo="body" 
  [modal]="true">
  <p-header style="position: center;">
      Dettaglio Lotto
  </p-header>
  <app-lotti-detail
    [lottoForm]="lottoForm"></app-lotti-detail>
  <p-footer>
    <div class="button-container-dialog">
      <button [style]="{width: '6rem', height: '2rem', margin: '0 1.5rem 0 0'}" pButton pRipple type="button" title="Salva" label="Salva" (click)="saveDialog()" [disabled]="lottoForm.invalid || lottoForm.pristine || !isReallyChangedAnything()"></button>
      <button [style]="{width: '6rem', height: '2rem'}" pButton pRipple type="button" title="Annulla" label="Annulla" (click)="cancelDialog()"></button>
    </div>
  </p-footer>
</p-dialog>
